"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a){function b(a){var b=Object.keys(a).sort();if(1===b.length){var c,d,e=b[0],f=a[e];switch(e){case"eq":c="only";break;case"gt":c="lowerBound",d=!0;break;case"lt":c="upperBound",d=!0;break;case"gte":c="lowerBound";break;case"lte":c="upperBound";break;default:throw new TypeError("`"+e+"` is not valid key")}return[c,[f,d]]}var g=a[b[0]],h=a[b[1]],i=b.join("-");switch(i){case"gt-lt":case"gt-lte":case"gte-lt":case"gte-lte":return["bound",[g,h,"gt"===b[0],"lt"===b[1]]];default:throw new TypeError("`"+i+"` are conflicted keys")}}function c(a){if(a&&"object"===("undefined"==typeof a?"undefined":_typeof(a))&&!(a instanceof d)){var c=b(a),e=_slicedToArray(c,2),f=e[0],g=e[1];return d[f].apply(d,_toConsumableArray(g))}return a}var d=a.IDBKeyRange||a.webkitIDBKeyRange,e={readonly:"readonly",readwrite:"readwrite"},f=Object.prototype.hasOwnProperty,g=function(a){return a},h=function(){if(!h&&(h=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB||a.shimIndexedDB,!h))throw new Error("IndexedDB required");return h}(),i={},j=Array.isArray,k=function(a,b,d){var f=this,g=!1;if(this.getIndexedDB=function(){return a},this.isClosed=function(){return g},this.add=function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;c>f;f++)d[f-1]=arguments[f];return new Promise(function(c,f){var h=this;if(g)return void f("Database has been closed");var i=[];d.forEach(function(a){j(a)?i=i.concat(a):i.push(a)});var k=a.transaction(b,e.readwrite),l=k.objectStore(b);i.forEach(function(a){var b;if(a.item&&a.key){var c=a.key;a=a.item,b=l.add(a,c)}else b=l.add(a);b.onsuccess=function(b){var c=b.target,d=c.source.keyPath;null===d&&(d="__id__"),Object.defineProperty(a,d,{value:c.result,enumerable:!0})}}),k.oncomplete=function(){return c(i,h)},k.onerror=function(a){a.preventDefault(),f(a)},k.onabort=function(a){return f(a)}})},this.update=function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;c>f;f++)d[f-1]=arguments[f];return new Promise(function(c,f){var h=this;if(g)return void f("Database has been closed");var i=a.transaction(b,e.readwrite),k=i.objectStore(b),l=[];d.forEach(function(a){j(a)?l=l.concat(a):l.push(a)}),l.forEach(function(a){if(a.item&&a.key){var b=a.key;a=a.item,k.put(a,b)}else k.put(a)}),i.oncomplete=function(){return c(l,h)},i.onerror=function(a){return f(a)},i.onabort=function(a){return f(a)}})},this.remove=function(b,c){return new Promise(function(d,f){if(g)return void f("Database has been closed");var h=a.transaction(b,e.readwrite),i=h.objectStore(b);i["delete"](c),h.oncomplete=function(){return d(c)},h.onerror=function(a){return f(a)},h.onabort=function(a){return f(a)}})},this.clear=function(b){return new Promise(function(c,d){if(g)return void d("Database has been closed");var f=a.transaction(b,e.readwrite),h=f.objectStore(b);h.clear(),f.oncomplete=function(){return c()},f.onerror=function(a){return d(a)},f.onabort=function(a){return d(a)}})},this.close=function(){if(g)throw new Error("Database has been closed");a.close(),g=!0,delete i[b]},this.get=function(b,d){return new Promise(function(e,f){if(g)return void f("Database has been closed");var h=a.transaction(b),i=h.objectStore(b);d=c(d);var j=i.get(d);j.onsuccess=function(a){return e(a.target.result)},h.onerror=function(a){return f(a)},h.onabort=function(a){return f(a)}})},this.query=function(b,c){if(g)throw new Error("Database has been closed");return new l(b,a,c)},this.count=function(b,d){return new Promise(function(e,f){if(g)return void f("Database has been closed");var h=a.transaction(b),i=h.objectStore(b);d=c(d);var j=void 0===d?i.count():i.count(d);j.onsuccess=function(a){return e(a.target.result)},h.onerror=function(a){return f(a)},h.onabort=function(a){return f(a)}})},!d){var h;return[].some.call(a.objectStoreNames,function(a){if(f[a])return h=new Error('The store name, "'+a+'", which you have attempted to load, conflicts with db.js method names."'),f.close(),!0;f[a]={};var b=Object.keys(f);b.filter(function(a){return"close"!==a}).map(function(b){return f[a][b]=function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return f[b].apply(f,[a].concat(d))}})}),h}},l=function(a,c,f){var h=this,i=!1,j=function(b,g,h,j,k,l,m){var n=c.transaction(a,i?e.readwrite:e.readonly),o=n.objectStore(a),p=f?o.index(f):o,q=b?d[b].apply(d,_toConsumableArray(g)):null,r=[],s=[q],t=0;k=k||null,l=l||[],"count"!==h&&s.push(j||"next");var u=i?Object.keys(i):!1,v=function(a){for(var b=0;b<u.length;b++){var c=u[b],d=i[c];d instanceof Function&&(d=d(a)),a[c]=d}return a};return p[h].apply(p,s).onsuccess=function(a){var b=a.target.result;if("number"==typeof b)r=b;else if(b)if(null!==k&&k[0]>t)t=k[0],b.advance(k[0]);else if(null!==k&&t>=k[0]+k[1]);else{var c=!0,d="value"in b?b.value:b.key;l.forEach(function(a){a&&a.length&&(c=2===a.length?c&&d[a[0]]===a[1]:c&&a[0](d))}),c&&(t++,i&&(d=v(d),b.update(d)),r.push(m(d))),b["continue"]()}},new Promise(function(a,b){n.oncomplete=function(){return a(r)},n.onerror=function(a){return b(a)},n.onabort=function(a){return b(a)}})},k=function(a,b){var c,d,e,f,h,k="next",l="openCursor",m=[],n=null,o=g,p=!1,q=function(){return j(a,b,l,p?k+"unique":k,n,m,o)},r=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return n=b.slice(0,2),1===n.length&&n.unshift(0),{execute:q}},s=function(){return k=null,l="count",{execute:q}},t=function(){return l="openKeyCursor",{desc:d,execute:q,filter:c,distinct:e,map:h}};return c=function(){for(var a=arguments.length,b=Array(a),g=0;a>g;g++)b[g]=arguments[g];return m.push(b.slice(0,2)),{keys:t,execute:q,filter:c,desc:d,distinct:e,modify:f,limit:r,map:h}},d=function(){return k="prev",{keys:t,execute:q,filter:c,distinct:e,modify:f,map:h}},e=function(){return p=!0,{keys:t,count:s,execute:q,filter:c,desc:d,modify:f,map:h}},f=function(a){return i=a,{execute:q}},h=function(a){return o=a,{execute:q,count:s,keys:t,filter:c,desc:d,distinct:e,modify:f,limit:r,map:h}},{execute:q,count:s,keys:t,filter:c,desc:d,distinct:e,modify:f,limit:r,map:h}};["only","bound","upperBound","lowerBound"].forEach(function(a){h[a]=function(){return k(a,arguments)}}),this.range=function(a){return k.apply(null,b(a))},this.filter=function(){var a=k(null,null);return a.filter.apply(a,arguments)},this.all=function(){return this.filter()}},m=function(a,b,c){if("function"==typeof b&&(b=b()),b&&0!==b.length){for(var d in c.objectStoreNames)if(c.objectStoreNames.hasOwnProperty(d)){var e=c.objectStoreNames[d];b.hasOwnProperty(e)===!1&&a.currentTarget.transaction.db.deleteObjectStore(e)}var g;for(g in b){var h,i=b[g];h=!f.call(b,g)||c.objectStoreNames.contains(g)?a.currentTarget.transaction.objectStore(g):c.createObjectStore(g,i.key);var j;for(j in i.indexes){var k=i.indexes[j];try{h.index(j)}catch(l){h.createIndex(j,k.key||j,Object.keys(k).length?k:{unique:!1})}}}}},n=function(a,b,c,d,e){var f=a.target.result;i[b]=f;var g=new k(f,b,c);return g instanceof Error?Promise.reject(g):Promise.resolve(g)},o={version:"0.12.0",open:function(a){return new Promise(function(b,c){if(i[a.server])n({target:{result:i[a.server]}},a.server,a.noServerMethods,a.version,a.schema).then(b,c);else{var d=h.open(a.server,a.version);d.onsuccess=function(d){return n(d,a.server,a.noServerMethods,a.version,a.schema).then(b,c)},d.onupgradeneeded=function(b){return m(b,a.schema,b.target.result)},d.onerror=function(a){return c(a)}}})},"delete":function(a){return new Promise(function(b,c){var d=h.deleteDatabase(a);d.onsuccess=function(a){return b(a)},d.onerror=function(a){return c(a)},d.onblocked=function(a){return c(a)}})},cmp:function(a,b){return h.cmp(a,b)}};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=o:"function"==typeof define&&define.amd?define(function(){return o}):a.db=o}(self);
//# sourceMappingURL=db.min.js.map